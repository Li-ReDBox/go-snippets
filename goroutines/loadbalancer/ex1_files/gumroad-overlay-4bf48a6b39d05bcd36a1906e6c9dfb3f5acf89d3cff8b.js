"use strict";!function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}(Element.prototype);const createGumroadOverlay=function(){function t(){window.GumroadOverlay||(window.GumroadOverlay=new a)}class e{setEnvironment(){this.environment="production",this[this.environment]=!0,this.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}startNodeAdditionObserver(){MutationObserver&&(this.nodeAdditionObserver=new MutationObserver(function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].addedNodes.length;i++)this.nodeAdditionCallback&&this.nodeAdditionCallback(t[e].addedNodes[i])}.bind(this)),this.nodeAdditionObserver.observe(document.body,{childList:!0,subtree:!0}))}get affiliateProductUrlRegExp(){return/.+\/a\/(?<affiliateId>.+)\/.+/}transformToCanonicalProductUrl(t){const e=t.match(this.affiliateProductUrlRegExp),i=new URLSearchParams(window.location.search).get("affiliate_id");if(null===e&&null===i)return t;if(null!==e){const i=e.groups,a=/\/a\/.+(\/.+)/,r=(t,e)=>`/l${e}`,n=new URL(t.replace(a,r));return n.searchParams.append("affiliate_id",i.affiliateId),n.href}if(null!==i){const e=new URL(t);return e.searchParams.append("affiliate_id",i),e.href}}}class i extends e{constructor(t,e){super(),this.setEnvironment(),this.validParams=["locale","referrer","wanted","email","gift","monthly","quarterly","biannually","yearly","duration","recommended_by","quantity","price","variant","affiliate_id","tier"],this.preserveRawValueParams=["variant"],this.element=t,this.manager=e,this.vars={as_modal:!0,referrer:encodeURIComponent(document.referrer+"/"+window.location.search.substring(1)),url_parameters:{source_url:encodeURIComponent(window.location.href)}};const i=this.element.getAttribute("href");if(i){const t=this.transformToCanonicalProductUrl(i);i!==t&&this.element.setAttribute("href",t)}this.validateUrl(),this.vars.affiliate_id&&(this.vars.url_parameters.affiliate_id=this.vars.affiliate_id)}makeActiveLink(){var t=document.createElement("span"),e=this,i=!1;if(t.className=this.manager.logoClassName,!this.element.getAttribute("data-gumroad-ignore")){if(this.manager.hasClass(this.element,"gumroad-button")){if(this.element.hasChildNodes())for(var a=0;a<this.element.childNodes.length;a++){var r=this.element.childNodes[a];"span"===r.nodeName.toLowerCase()&&this.manager.hasClass(r,this.manager.logoClassName)&&(i=!0)}i||this.element.insertBefore(t,this.element.firstChild)}if(this.element.getAttribute("data-gumroad-default-cover")){var n=document.createElement("img");n.src=this.manager.domain+"/products/"+this.vars.permalink+"/default_cover",this.element.insertBefore(n,this.element.firstChild)}this.element.getAttribute("data-gumroad-single-product")&&(this.manager.isSingleProductMode=!0),this.origin!==this.manager.domain&&(this.element.target="_blank"),this.element.onclick=function(t){t.preventDefault(),e.manager.showInIframe(e)}}}setUrlVars(t){if(t){var e=t.split("&");if(e.length)for(var i=0;i<e.length;i++)if(e[i]){var a=decodeURIComponent(e[i]).split("="),r=e[i].split("=")[1];if(2===a.length){var n=a[0],o=-1!==this.preserveRawValueParams.indexOf(n)?r:a[1];this.validParams.indexOf(a[0])>-1?this.vars[n]=o:this.vars.url_parameters[n]=o}}}}validateUrl(){for(var t=this.element.href.split("?"),e=t[0],i=0;i<this.manager.productMatches.length;i++){var a=this.manager.productMatches[i];if(0===e.indexOf(a)){var r=e.replace(a,"").split("/");return this.vars.permalink=r[0],"function"==typeof window.URLSearchParams&&(this.vars.offerCodeName=new URLSearchParams(this.element.search).get("offer_code")),!this.vars.offerCodeName&&r[1]&&r[1].length>0&&(this.vars.offerCodeName=r[1]),this.setUrlVars(t[1]),this.manager.links.push(this),this.manager.allPermalinks.indexOf(this.vars.permalink)<0&&this.manager.allPermalinks.push(this.vars.permalink),this.manager.allPermalinks=this.manager.allPermalinks.slice(-4),this.makeActiveLink(),!0}}}}class a extends e{constructor(){super(),this.setEnvironment(),this.links=[],this.allPermalinks=[],window.addEventListener?window.addEventListener("message",function(t){this.gotMessage(t)}.bind(this),!1):window.attachEvent("onmessage",function(t){this.gotMessage(t)}.bind(this),!1),this.setDomain(),this.insertStylesheet(),this.insertLoadingIndicator(),this.bindKeys(),this.addLinks(),this.domain!==this.origin&&1===this.links.length&&(this.isSingleProductMode=!0),this.createIframe(),this.startNodeAdditionObserver(),this.maxWindowHeight=/iPhone/.test(navigator.userAgent)?window.innerHeight:null}get logoClassName(){return"gumroad-button-logo"}setDomain(){const t=document.querySelector("script[src*='/js/gumroad.js']");t&&(this.domain=new URL(t.src).origin,this.productMatches.push(`${this.domain}/l/`),"https://gumroad.com"===this.domain&&(this.domain="https://app.gumroad.com"),this.productMatches=[...new Set(this.productMatches)])}addLinks(){for(var t=document.querySelectorAll("a:not(.gr-overlay-disabled),area"),e=this,a=0;a<t.length;a++)new i(t[a],e)}append(t,e){e=e||"body",document.getElementsByTagName(e)[0].appendChild(t)}askForProduct(){if(this.currentLink){var t=this.getGoogleAnalyticsClientId();t&&(this.currentLink.vars.googleAnalyticsClientId=t),this.messageIframe({overlayMethod:"getProduct",overlayArgs:this.currentLink.vars})}}getGoogleAnalyticsClientId(){if("string"==typeof window.GoogleAnalyticsObject&&"function"==typeof window[window.GoogleAnalyticsObject]&&"function"==typeof window[window.GoogleAnalyticsObject].getAll){var t=window[window.GoogleAnalyticsObject].getAll(),e="object"==typeof t?t[0]:null;if("object"==typeof e&&"function"==typeof e.get)return e.get("clientId")}}bindKeys(){document.onkeydown=function(t){"Escape"===t.key&&this.minimizeIframe()}.bind(this)}buildIframeSrc(){var t=(this.domain?this.domain:"")+"/overlay_page",e=[];if(this.isSingleProductMode&&e.push("single_product_mode=true"),this.allPermalinks&&this.allPermalinks.length>0&&e.push("all_permalinks="+this.allPermalinks.join(",")),this.currentLink)for(var i in this.currentLink.vars)this.currentLink.vars.hasOwnProperty(i)&&e.push(i+"="+this.currentLink.vars[i]);return e.length>0&&(t+="?"+e.join("&")),t}setScrollContainerStyle(t){t||(t={width:"0px",height:"0px"});var e="max-width:"+window.innerWidth+"px;max-height:"+(this.maxWindowHeight||window.innerHeight)+"px;";this.scrollContainer&&(this.scrollContainer.style=e+"width:"+t.width+";height:"+t.height)}restoreBodyScroll(){document.getElementsByTagName("body")[0].classList.remove("gumroad-overflow-hidden")}disableBodyScroll(){document.getElementsByTagName("body")[0].classList.add("gumroad-overflow-hidden")}createIframe(){var t=this;this.iframe&&(this.iframe.remove(),delete this.iframe,delete this.iframeReady),this.scrollContainer=document.createElement("div"),this.scrollContainer.className="gumroad-scroll-container",this.setScrollContainerStyle(),this.append(this.scrollContainer),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("allowFullScreen","allowfullscreen"),this.iframe.setAttribute("allowPaymentRequest","allowpaymentrequest"),this.iframe.allowtransparency=!0,this.iframe.className="gumroad-overlay-iframe",this.iframe.onload=function(){t.setupMessaging()},this.iframe.src=this.buildIframeSrc(),this.scrollContainer.append(this.iframe)}gotMessage(t){var e={};if(t.data)try{e=JSON.parse(t.data)}catch(t){}e.parentMethod&&this[e.parentMethod]&&this[e.parentMethod](e.parentArgs)}handshake(){this.iframeReady||(this.iframeReady=!0,clearInterval(this.handshakeTimer),delete this.handshakeTimer,this.messagingSetupCallback())}hasClass(t,e){return t.classList.toString().split(/\s+/).indexOf(e)>-1}hideLoadingIndicator(){this.setOpacity(this.loadingIndicator,0)}insertLoadingIndicator(){this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="gumroad-loading-indicator",this.loadingIndicator.appendChild(document.createElement("i")),this.append(this.loadingIndicator)}insertStylesheet(){var t='a.gumroad-button { background-color: white !important; background-image: url("GUMROAD_ORIGIN/button/button_bar.jpg") !important; background-repeat: repeat-x !important; border-radius: 4px !important; box-shadow: rgba(0, 0, 0, 0.4) 0 0 2px !important; color: #999 !important; display: inline-block !important; font-family: -apple-system, ".SFNSDisplay-Regular", "Helvetica Neue", Helvetica, Arial, sans-serif !important; font-size: 16px !important; font-style: normal !important; font-weight: 500 !important; line-height: 50px !important; padding: 0 15px !important; text-shadow: none !important; text-decoration: none !important; } .gumroad-button-logo { background-image: url("GUMROAD_ORIGIN/button/button_logo.png") !important; background-size: cover !important; height: 17px !important; width: 16px !important; display: inline-block !important; margin-bottom: -3px !important; margin-right: 15px !important; } .gumroad-loading-indicator { background: white; border-radius: 50%; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); box-sizing: border-box; display: none; height: 60px; left: 50% !important; margin-left: -30px !important; margin-top: -30px !important; padding: 10px; position: fixed; top: 50% !important; width: 60px; z-index: 99997; } .gumroad-loading-indicator i { background: url("GUMROAD_ORIGIN/js/loading-rainbow.svg"); height: 40px; width: 40px; display: inline-block; background-size: contain; animation: gumroad-spin 1.5s infinite linear; } .gumroad-scroll-container { -webkit-overflow-scrolling: touch; overflow-y: auto; position: fixed !important; z-index: 99998 !important; top: 0 !important; right: 0 !important; -ms-overflow-style: none; scrollbar-width: none; text-align: start; } .gumroad-scroll-container::-webkit-scrollbar { display: none; } .gumroad-overflow-hidden { overflow: hidden !important; } .gumroad-overlay-iframe { position: absolute; min-width: 100%; min-height: 100%; border: none !important; } @keyframes gumroad-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(359deg); } } '.replace(/GUMROAD_ORIGIN/g,this.domain),e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(t)),this.append(e,"head")}maximizeIframe(t){const e=this.maxWindowHeight||window.innerHeight,i={width:`${window.innerWidth}px`,height:`${e}px`};this.hideLoadingIndicator(),this.setScrollContainerStyle(i),this.disableBodyScroll(),this.resizeIframe(i)}messageIframe(t){this.iframe&&("object"==typeof t&&(t=JSON.stringify(t)),this.iframe.contentWindow.postMessage(t,this.domain))}messagingSetupCallback(){this.askForProduct(),this.messageIframe({overlayMethod:"getPersistentBundle"})}minimizeIframe(t){this.restoreBodyScroll(),this.hideLoadingIndicator(),this.isSingleProductMode?this.setScrollContainerStyle():(this.setScrollContainerStyle(t),this.resizeIframe(t)),this.messageIframe("stopPreviews")}nodeAdditionCallback(){this.resetLinks()}redirect(t){t&&t.match(/^http/)&&(window.location.href=t)}reload(){this.minimizeIframe(),this.resetLinks()}resetLinks(){this.links=[],this.addLinks()}resizeIframe(t){if(this.iframe){var e=[];(t=t||{width:"0px",height:"0px"}).width&&e.push("width: "+t.width),t.height&&e.push("height: "+t.height),this.iframe.style=e.join(";")}}sendDomain(){this.messageIframe({overlayMethod:"setOverlayParentDomain",overlayArgs:this.origin})}setEnvironment(){super.setEnvironment(),this.productMatches=["http://gum.co/","https://gum.co/","https://app.gumroad.com/l/"]}setOpacity(t,e){t.style.display=0===e?"none":"block",t.style.opacity=t.style.MozOpacity=t.style.khtmlOpacity=e,t.style.filter="alpha(opacity="+100*e+");"}setupMessaging(){this.handshakeTimer=setInterval(function(){this.sendDomain()}.bind(this),100)}showInIframe(t){this.currentLink=t,this.showLoadingIndicator(),this.iframeReady?this.askForProduct():this.createIframe()}showLoadingIndicator(){this.setOpacity(this.loadingIndicator,1)}}return t}();window.addEventListener?window.addEventListener("load",createGumroadOverlay):window.attachEvent&&window.attachEvent("onload",createGumroadOverlay);